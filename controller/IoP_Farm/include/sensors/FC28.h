/*
 * Датчик влажности почвы FC28 (гигрометр почвы)
 * 
 * Принцип работы:
 * 1. Физическая конструкция: 
 *    - Датчик состоит из двух электродов (щупов), которые вставляются в почву
 *    - На плате модуля расположен компаратор LM393 для формирования цифрового сигнала
 *    - Содержит встроенный потенциометр для регулировки порога срабатывания цифрового выхода
 * u
 * 2. Принцип измерения:
 *    - При погружении щупов в почву, между электродами образуется цепь проводимости
 *    - Чем больше влаги в почве, тем лучше проводимость (меньше сопротивление)
 *    - Чем меньше влаги, тем хуже проводимость (больше сопротивление)
 *    - Плата измеряет сопротивление и преобразует его в аналоговый сигнал напряжения
 *    - АЦП микроконтроллера измеряет это напряжение в диапазоне 0-4095 (для ESP32)
 * 
 * 3. Подключение:
 *    - VCC → 3.3V
 *    - GND → GND ESP32
 *    - AO (аналоговый выход) → аналоговый пин ESP32 (например, GPIO36)
 *    - DO (цифровой выход) → не используется в данной реализации
 * 
 * 4. Калибровка:
 *    - dryValue - значение АЦП в сухой почве (обычно около 4095)
 *    - wetValue - значение АЦП в очень влажной почве (обычно около 0-1000)
 *    - Калибровка необходима для корректного определения процента влажности
 *    - Для калибровки используйте метод setCalibration()
 * 
 * 5. Процесс калибровки:
 *    - Для определения dryValue: вставьте щупы в сухую почву (или воздух), запишите показания getRawValue()
 *    - Для определения wetValue: вставьте щупы в очень влажную почву, запишите показания getRawValue()
 *    - Установите полученные значения через setCalibration(dryValue, wetValue)
 * 
 * 6. Важные замечания:
 *    - Датчик подвержен коррозии при длительном использовании из-за электролиза
 *    - Для продления срока службы рекомендуется:
 *      а) Использовать питание 3.3V вместо 5V
 *      б) Подавать питание на датчик только на время измерения
 *      в) Использовать покрытые никелем или позолоченные электроды
 *    - Точность измерений зависит от типа почвы и качества калибровки
 * 
 * 7. Характеристики:
 *    - Рабочее напряжение: 3.3V-5V
 *    - Выходной сигнал: аналоговый (0-4095 для ESP32)
 *    - Диапазон измерения: от 0% (сухая почва) до 100% (влажная почва)
 */

// Аналоговый датчик влажности почвы
#pragma once

#include "sensors/ISensor.h"
#include "config/constants.h"

namespace farm::sensors
{
    class FC28 : public ISensor
    {
    private:
        uint8_t pin;
        
        int dryValue;    // Значение АЦП для сухой почвы
        int wetValue;    // Значение АЦП для влажной почвы
        
    public:
        FC28(std::shared_ptr<log::ILogger> logger, uint8_t pin);

        bool initialize() override;
        
        // Считать влажность почвы в процентах (0-100%)
        float read() override;
        
        // Получить текущее сырое значение АЦП
        int getRawValue() const;
        
        void setCalibration(int dryValue, int wetValue);
    };
} 