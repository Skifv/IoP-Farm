# IoP-Farm (Internet of Plants Farm)

## Проектная документация

### Содержание
1. [Задача проекта](#задача-проекта)
2. [Описание решения](#описание-решения)
3. [Аппаратная часть](#аппаратная-часть)
   - [Компоненты](#компоненты)
   - [Схема подключения](#схема-подключения)
4. [Программная часть](#программная-часть)
   - [Архитектура](#архитектура)
   - [Основные модули](#основные-модули)
5. [Производство](#производство)
   - [Использованные инструменты и оборудование](#использованные-инструменты-и-оборудование)
   - [Процесс сборки](#процесс-сборки)
6. [Трудности и проблемы](#трудности-и-проблемы)
7. [Результаты](#результаты)
8. [Дальнейшее развитие](#дальнейшее-развитие)

## Задача проекта

Создание компактной автоматизированной умной фермы для выращивания сельскохозяйственных культур с возможностью удаленного мониторинга и управления через мобильное приложение. Система должна обеспечивать автоматический полив, контроль микроклимата, освещения и передачу данных в режиме реального времени.

## Описание решения

IoP-Farm (Internet of Plants Farm) представляет собой полностью автоматизированную мини-ферму на базе микроконтроллера ESP32, объединяющую аппаратную и программную части в единую экосистему для выращивания растений.

Основные функциональные возможности:

- **Автоматический полив**: система на основе данных о влажности почвы и расписания включает насос R385, который подает воду в количестве, необходимом конкретной культуре.

- **Контроль температуры**: датчики DHT22 и DS18B20 следят за температурой воздуха и почвы, а система автоматически включает тепловую лампу при падении температуры ниже заданного порога.

- **Управление освещением**: фитолента включается и выключается по заданному расписанию, обеспечивая оптимальный световой режим для растений.

- **Мониторинг уровня воды**: ультразвуковой датчик HC-SR04 контролирует уровень воды в резервуаре, предупреждая о необходимости его пополнения.

- **WiFi и MQTT-интеграция**: система подключается к домашней сети WiFi и отправляет данные на MQTT-сервер, что позволяет управлять фермой удаленно.

- **Мобильное приложение**: специальное Android-приложение позволяет в реальном времени мониторить все показатели, менять настройки и управлять исполнительными устройствами.

## Аппаратная часть

### Компоненты

#### Микроконтроллер
- **ESP32 WROOM 32**: 32-битный двухъядерный микроконтроллер с WiFi и Bluetooth, 4 МБ Flash-памяти, 520 КБ SRAM

#### Датчики
- **DHT22**: цифровой датчик температуры и влажности воздуха
- **DS18B20**: цифровой датчик температуры с водонепроницаемым корпусом для измерения температуры почвы
- **HC-SR04**: ультразвуковой датчик расстояния для контроля уровня воды в резервуаре
- **FC-28**: аналоговый датчик влажности почвы
- **KY-018**: фоторезистор для определения уровня освещенности
- **YFS401**: датчик расхода воды (расходомер)

#### Исполнительные устройства
- **Насос R385**: водяной насос для полива растений
- **Тепловая лампа**: для поддержания нужной температуры воздуха
- **Фитолента (LED)**: специализированное освещение для оптимального роста растений

#### Блок питания
- **12V адаптер питания** для ESP32 через DC-Jack, насоса и всех остальных устройств при помощи DC-DC преобразователей.

#### Корпус
- Корпус из прозрачного акрилового стекла (оргстекла) толщиной 6 мм
- 3D-печатные крепления и держатели для датчиков и актуаторов
- Ведро для воды, помещенное в пластиковую тонкую оболочку

![Альтернативный текст](/image.png)

### Схема подключения

Датчики и актуаторы подключены к ESP32 согласно схеме, описанной в файле схемы и в заголовочных файлах исходного кода. 

## Программная часть

### Архитектура

Программное обеспечение IoP-Farm построено на принципах объектно-ориентированного программирования и модульной архитектуры. Это позволяет легко расширять функциональность и добавлять новые компоненты без изменения основной структуры - стандартные принципы ООП.

### Основные модули

1. **Датчики (sensors)**: Абстракция всех датчиков через интерфейс `ISensor`, который определяет единый метод получения данных. Каждый датчик реализован как отдельный класс, наследующийся от базового интерфейса.

2. **Актуаторы (actuators)**: Все исполнительные устройства реализованы через интерфейс `IActuator`. Включает в себя насос, тепловую лампу и фитоленту.

3. **Стратегии (strategies)**: Определяют логику работы актуаторов на основе данных от датчиков и расписания. Реализованы стратегии полива, нагрева и освещения. Позволяют легко масшабировать систему и являются основой нашей экосистемы.

4. **Менеджеры (managers)**:
   - **WiFiManager**: Управление WiFi-соединением, создание точки доступа при необходимости
   - **MQTTManager**: Подключение к MQTT-брокеру, отправка/получение сообщений
   - **ConfigManager**: Управление конфигурацией в SPIFFS, загрузка дефолтных настроек
   - **OTAManager**: Обеспечение обновления прошивки по воздуху
   - **WebServerManager**: Веб-интерфейс для конфигурации

5. **Логирование**: Система логирования с различными уровнями, форматтерами и транспортами (Serial, MQTT).

6. **Мобильное приложение**: Android-приложение для управления фермой, разработанное на Java, взаимодействующее с системой через MQTT.

## Производство

### Использованные инструменты и оборудование

- **3D-принтеры** для изготовления креплений, держателей и функциональных деталей
- **Лазерные резаки** для точной обработки акрилового стекла
- **Паяльная станция** для монтажа электронных компонентов
- **Струбцины** для склейки оргстекла дихлорэтаном
- **Ручной инструмент** (отвертки, плоскогубцы, кусачки и т.д.)
- **Мультиметр** для тестирования электрических цепей

## Трудности и проблемы

В процессе разработки и реализации проекта мы столкнулись с несколькими серьезными проблемами:

1. **Проблемы с 3D-печатью**: Постоянно приходилось переставлять 3D-принтеры на печать из-за проблем с первым слоем. Это значительно замедлило процесс изготовления деталей и корпуса.

2. **Ограничения пуш-уведомлений**: Не удалось реализовать пуш-уведомления на Android из-за того, что они зависят от сервисов Google Firebase Cloud Messaging (FCM), доступ к которым ограничен в России из-за санкций. Android запрещает фоновым приложениям выполнять определенные действия, если они не используют официальные API Google.

3. **Трудности с микроконтроллерами**: Изначально проект планировалось реализовать на STM32, но из-за отмены курса по микроконтроллерам и отсутствия достаточного опыта работы с ними, более двух недель ушло на попытки настроить STM32. В итоге было принято решение перейти на более удобную в разработке платформу ESP32.

4. **Интеграция аппаратной и программной частей**: Потребовалось много времени на отладку взаимодействия между датчиками, ESP32 и исполнительными устройствами, особенно в части обработки ошибок и надежности системы.

## Результаты

В результате проекта была создана полностью функциональная автоматизированная мини-ферма с возможностью удаленного управления. Система обеспечивает:

- Полностью автоматический полив на основе показаний датчиков влажности почвы
- Контроль и поддержание температуры окружающей среды
- Управление освещением по расписанию
- Удобный мониторинг всех показателей через мобильное приложение
- Возможность ручного управления всеми исполнительными устройствами
- Настройку и конфигурирование системы без необходимости физического доступа к устройству

## Дальнейшее развитие

Планы по дальнейшему развитию проекта включают:

1. **Масштабирование системы** для поддержки нескольких ферм с централизованным управлением
2. **Расширение набора датчиков** (pH почвы, CO2, содержание минералов)
3. **Улучшение** внешнего вида приложения

---

Проект IoP-Farm демонстрирует, как современные технологии могут быть применены для решения практических задач в области сельского хозяйства и домашнего растениеводства, обеспечивая оптимальные условия выращивания с минимальным участием человека. 